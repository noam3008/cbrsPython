import datetime as DT
import xml.etree.cElementTree as ET
from controllers.CLIUtils.enums import TestStatus
class xmlCreation(object):
    '''
    classdocs
    '''


    def __init__(self,folderName, testName,dirPath,isFolderExists):
        '''
        Constructor
        '''
        self.startTime = DT.datetime.now()
        self.testName = testName
        self.dirPath = dirPath
        self.folderName = folderName
        self.root = None
        self.testCases = None
        self.testCase = None
        if(isFolderExists == False):
            self.build_folder_xml()
        elif(isFolderExists == True):
            self.initialize_From_Existing_Xml()
            
    def build_folder_xml(self):
        root = ET.Element('ns0:test-suite')
        root.set("xmlns:ns0","urn:model.allure.qatools.yandex.ru")
        root.set("start",str(DT.datetime.now().strftime("%Y%m%d%H%M%S")))
        ET.SubElement(root,"name").text = self.folderName
        ET.SubElement(root,"labels")
        self.testCases = ET.SubElement(root,"test-cases")
        self.root = root
        
    def set_end_time(self):
        self.root.set("stop",str(DT.datetime.now().strftime("%Y%m%d%H%M%S")))
            
    def buildXml(self):
        self.testCase = ET.SubElement(self.testCases,"test-case")
        self.testCase.set("start","1496066956106")
        self.testCase.set("status","passed")
        self.testCase.set("stop","1496066956106")
        ET.SubElement(self.testCase,"name").text = "registration_test"
        attachments = ET.SubElement(self.testCase,"attachments")
        attachments.set("source","59f0fe72-7489-48f3-a826-7588a4642fc8-attachment.txt")
        attachments.set("title","Captured stdout call")
        attachments.set("type","text/plain")
        label =  ET.SubElement(self.testCase,"labels")
        labelname = ET.SubElement(label,"label")
        labelname.set("name","severity")
        
        '''<steps>
        <step start="1496305434173" status="passed" stop="1496305434173">
          <name>make_test_data_foo</name>
          <title>make_test_data_foo</title>
          <attachments/>
          <steps/>
        </step>
        </steps>'''
        
        self.set_end_time()
 
        print ET.tostring(self.root)
        # write to file:
        tree = ET.ElementTree(self.root)
        tree.write(self.dirPath + "\\" +self.folderName +"-testsuite" ".xml")
    
    def initialize_From_Existing_Xml(self):
        tree = ET.parse(self.dirPath + "\\" +self.folderName +"-testsuite" ".xml")
        self.root = tree.getroot()
        self.testCases = tree.find("test-cases")
        
    def reportStep(self,jsonFileName,testStatus):
        if (testStatus == TestStatus.PASSED):
            ET.SubElement(self.testCase,"steps")
            
        
        
'''<ns0:test-suite xmlns:ns0="urn:model.allure.qatools.yandex.ru" start="1496045320533" stop="1496045320540">
  <name>gui</name>
  <labels/>
  <test-cases>
    <test-case start="1496045320533" status="passed" stop="1496045320540">
      <name>registration_test</name>
      <attachments>
        <attachment source="59f0fe72-7489-48f3-a826-7588a4642fc8-attachment.txt" title="Captured stdout call" type="text/plain"/>
      </attachments>
      <labels>
        <label name="severity" value="normal"/>
        <label name="thread" value="1464-MainThread"/>
        <label name="host" value="ASIL-IT17"/>
      </labels>
      <steps/>
      </test-case>
  </test-cases>
</ns0:test-suite>'''

